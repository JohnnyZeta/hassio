
  - alias: Partenza Ale
    trigger:
      platform: zone
      entity_id: device_tracker.iphone_di_alessandra
      zone: zone.lavoro_2
      event: leave
    condition:
      condition: time
      after: '17:00:00'
      before: '00:00:00'
      weekday:
        - mon
        - tue
        - wed
        - thu
        - fri
    action:
      service: notify.ios_iphone_di_alby
      data:
        message: "Alessandra Ã¨ partita!"

###############################################################################

  - alias: Arrivo Ale
    trigger:
      platform: zone
      entity_id: device_tracker.iphone_di_alessandra
      zone: zone.home
      event: enter
    condition:
      condition: time
      after: '17:00:00'
      before: '00:00:00'
      weekday:
        - mon
        - tue
        - wed
        - thu
        - fri
    action:
      service: xiaomi_aqara.play_ringtone
      data:
        gw_mac: 78:11:DC:B0:72:7E
        ringtone_id: 12
        ringtone_vol: 30

###############################################################################

  - alias: Richiesta Location Ale
    trigger:
      platform: zone
      entity_id: device_tracker.iphone_di_alessandra
      zone: zone.home
      event: leave
    condition:
      condition: time
      after: '07:00:00'
      before: '12:00:00'
      weekday:
        - mon
        - tue
        - wed
        - thu
        - fri
    action:
      - delay: '00:{{ states.sensor.ale_casalavoro.state | int + 5 }}:00'
      - service: notify.ios_iphone_di_alessandra
        data:
          message: "request_location_update"

###############################################################################

  - alias: Richiesta Location Alby
    trigger:
      platform: zone
      entity_id: device_tracker.iphone_di_alby
      zone: zone.home
      event: leave
    condition:
      condition: time
      after: '07:00:00'
      before: '12:00:00'
      weekday:
        - mon
        - tue
        - wed
        - thu
        - fri
    action:
      - delay: '00:{{ states.sensor.alby_casalavoro.state | int + 5 }}:00'
      - service: notify.ios_iphone_di_alby
        data:
          message: "request_location_update"

###############################################################################

  - alias: Avviso Tempo Ritorno Ale
    trigger:
      platform: numeric_state
      entity_id: sensor.lavorocasa_ale
      above: 40
      for:
        hours: 1
    condition:
      - condition: time
        after: '16:00:00'
        before: '21:00:00'
        weekday:
          - mon
          - tue
          - wed
          - thu
          - fri
      - condition: zone
        entity_id: device_tracker.iphone_di_alessandra
        zone: zone.lavoro_2
    action:
      service: notify.ios_iphone_di_alessandra
      data_template:
        title: "Probabile Coda!"
        message: >
          Tempo di ritorno previsto in {{ states.sensor.lavorocasa_ale.state }} minuti.

###############################################################################

  - alias: Avviso Tempo Ritorno Alby
    trigger:
      platform: numeric_state
      entity_id: sensor.lavorocasa_alby
      above: 33
      for:
        hours: 1
    condition:
      - condition: time
        after: '16:00:00'
        before: '21:00:00'
        weekday:
          - mon
          - tue
          - wed
          - thu
          - fri
      - condition: zone
        entity_id: device_tracker.iphone_di_alby
        zone: zone.lavoro
    action:
      service: notify.ios_iphone_di_alby
      data_template:
        title: "Probabile Coda!"
        message: >
          Tempo di ritorno previsto in {{ states.sensor.lavorocasa_alby.state }} minuti.

###############################################################################

