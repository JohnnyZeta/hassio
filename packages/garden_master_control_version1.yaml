# #=================
# # === Automations
# #=================
# automation:

#   #====================================================================
#   #=== Master Control switch 
#   #===
#   #=== This turns on or off,
#   #===   All the Irrigation automations.
#   #===   All the automations related to Weather used in Irrigation.
#   #===
#   #===   i.e. all automations with a name beginning with either
#   #===        'Irrigation - ' or
#   #===        'Irrigation Weather - '
#   #===
#   #=== Also checks when HA starts.
#   #====================================================================
#   - alias: Irrigazione - Controllo Master
#     trigger:
#       - platform: state
#         entity_id: input_boolean.irrigation_master_control

#       - platform: homeassistant
#         event: start

#     action:
#       #=== Stop both cycles
#       - service: input_boolean.turn_off
#         data:
#           entity_id: 
#             - input_boolean.cycle1_manual_run
#             - input_boolean.cycle2_manual_run

#       #=== Turn all Irrigation automations on or off (EXCEPT this one!)
#       - service_template: >
#           {% if is_state('input_boolean.irrigation_master_control', 'on') %}
#             automation.turn_on
#           {% else %}
#             automation.turn_off
#           {% endif %}
#         data_template:
#           entity_id: >
#             {% for item in states['automation'] if item.name.startswith('Irrigazione - ') and item.name.find('Controllo Master') == -1 -%}
#               {% if not loop.first %},{% endif %}{{ item.entity_id }}
#             {%- endfor %}

#       #=== Turn all Weather Irrigation automations on or off
#       - service_template: >
#           {% if is_state('input_boolean.irrigation_master_control', 'on') %}
#             automation.turn_on
#           {% else %}
#             automation.turn_off
#           {% endif %}
#         data_template:
#           entity_id: >
#             {% for item in states['automation'] if item.name.startswith('Irrigazione Meteo - ') -%}
#               {% if not loop.first %},{% endif %}{{ item.entity_id }}
#             {%- endfor %}